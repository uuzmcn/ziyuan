# WP Disk Link Manager

一个功能强大的WordPress插件，用于从Excel导入文章并自动转存网盘链接。

## 主要功能

### 1. Excel导入功能
- 支持导入.xls和.xlsx格式的Excel文件
- Excel格式：第一列为文章标题，第二列为网盘链接
- 自动创建草稿文章或直接发布
- 支持跳过标题行
- 详细的导入结果反馈

### 2. 网盘链接管理
- 支持百度网盘、夸克网盘、迅雷网盘和磁力链
- 自动识别链接类型并显示对应按钮
- 全局和文章级别的显示设置
- 智能转存避免重复操作

### 3. 自动转存功能
- 用户点击按钮时自动转存到预设网盘账号
- 实时显示转存进度
- 设置转存链接有效期
- 防止重复转存（缓存机制）

### 4. 定时清理
- 自动清理过期的转存文件
- 删除网盘中的文件和分享链接
- 可配置清理间隔和保留时间
- 支持手动触发清理

### 5. 日志记录
- 详细记录所有操作
- 包括导入、转存、清理等操作
- 支持按时间、操作类型筛选
- 自动清理旧日志

## 安装方法

1. 将插件文件上传到 `/wp-content/plugins/wp-disk-link-manager/` 目录
2. 在WordPress管理后台的"插件"页面激活插件
3. 在"网盘链接"菜单中进行设置

## 使用说明

### 基本设置

1. **网盘账号配置**
   - 进入"网盘链接" → "设置"
   - 配置百度网盘和夸克网盘的Cookie
   - Cookie获取方法：
     - 在浏览器中登录对应网盘
     - 按F12打开开发者工具
     - 切换到Network标签
     - 刷新页面，找到请求头中的Cookie
     - 复制完整的Cookie字符串

2. **显示设置**
   - 设置哪些网盘链接直接显示（不转存）
   - 磁力链默认直接显示
   - 可在文章编辑时单独设置

3. **转存设置**
   - 设置转存链接的有效期（小时）
   - 建议设置为24-72小时

### Excel导入

1. **Excel文件准备**
   ```
   文章标题                        | 网盘链接
   电影资源1                      | https://pan.baidu.com/s/xxxxx
   软件下载                       | https://pan.quark.cn/s/xxxxx
   游戏资源                       | magnet:?xt=urn:btih:xxxxx
   ```

2. **导入操作**
   - 进入"网盘链接" → "导入Excel"
   - 选择Excel文件
   - 设置导入选项
   - 点击"开始导入"

3. **查看结果**
   - 导入完成后查看成功和失败统计
   - 检查错误详情
   - 编辑导入的文章

### 文章发布

1. **编辑文章**
   - 在文章编辑页面右侧可看到"网盘链接设置"
   - 可设置每个链接是否直接显示

2. **前端显示**
   - 发布后用户可在文章中看到网盘按钮
   - 点击按钮开始转存过程
   - 转存完成后按钮变为下载链接

### 监控和维护

1. **查看统计**
   - 在主面板查看总体统计
   - 包括文章数、转存数、有效转存等

2. **查看日志**
   - 进入"网盘链接" → "日志"
   - 筛选查看各种操作记录
   - 监控转存成功率

3. **手动清理**
   - 在主面板点击"立即清理"
   - 手动触发过期文件清理

## 支持的网盘格式

### 百度网盘
```
https://pan.baidu.com/s/1xxxxxxx
https://pan.baidu.com/s/1xxxxxxx?pwd=abcd
```

### 夸克网盘
```
https://pan.quark.cn/s/xxxxxxx
https://pan.quark.cn/s/xxxxxxx?pwd=abcd
```

### 迅雷网盘
```
https://pan.xunlei.com/s/xxxxxxx
```

### 磁力链
```
magnet:?xt=urn:btih:xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
```

## 安全注意事项

1. **Cookie安全**
   - Cookie包含敏感信息，请妥善保管
   - 定期更换Cookie
   - 不要在不安全的网络环境下操作

2. **文件上传**
   - 插件会验证Excel文件的安全性
   - 限制文件大小为10MB
   - 自动清理临时文件

3. **权限控制**
   - 只有管理员可以进行导入和设置操作
   - 转存操作对所有用户开放
   - 可根据需要调整权限

## 故障排除

### 常见问题

1. **Excel导入失败**
   - 检查文件格式是否正确
   - 确认文件大小不超过10MB
   - 检查Excel内容格式

2. **转存失败**
   - 检查Cookie是否过期
   - 确认网盘链接格式正确
   - 查看错误日志获取详细信息

3. **定时清理不工作**
   - 检查WordPress定时任务是否正常
   - 可尝试手动清理测试
   - 查看服务器错误日志

### 日志查看

插件会详细记录所有操作：
- 导入操作和结果
- 转存成功和失败
- 清理操作详情
- 错误信息和调试信息

## 开发说明

### 网盘API扩展

如需添加新的网盘支持：

1. 在`class-disk-manager.php`中添加对应的转存方法
2. 在主类中添加网盘类型识别
3. 添加对应的按钮样式

### 自定义样式

可通过主题的CSS文件覆盖插件样式：
```css
.wp-disk-link-button.custom {
    background: #your-color;
}
```

## 版本历史

### 1.0.0
- 初始版本发布
- 支持Excel导入
- 百度网盘和夸克网盘转存
- 定时清理功能
- 完整的日志记录

## 技术要求

- WordPress 5.0+
- PHP 7.4+
- 需要PHP扩展：ZIP, cURL
- MySQL 5.6+

## 许可证

GPL v2 or later

## 支持

如有问题或建议，请通过以下方式联系：
- GitHub Issues
- 邮箱：support@example.com

---

**注意：使用本插件前请确保遵守相关网盘服务的使用条款。**