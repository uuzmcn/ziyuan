# WP Disk Link Manager - 故障排除指南

## 常见错误及解决方案

### 转存相关错误

#### 1. "转存失败: 夸克网盘转存失败: HTTP请求失败，状态码: 500"

**原因分析：**
- 夸克网盘服务器内部错误
- Cookie已过期或无效
- 请求频率过高被限制
- 网盘链接格式不正确

**解决步骤：**

1. **检查Cookie有效性**
   ```
   - 进入"网盘链接" → "设置"
   - 点击夸克网盘Cookie旁的"测试Cookie"按钮
   - 如果提示无效，需要重新获取Cookie
   ```

2. **重新获取Cookie**
   ```
   - 在浏览器中登录 https://pan.quark.cn
   - 按F12打开开发者工具
   - 切换到Network标签
   - 刷新页面
   - 找到任意请求，复制完整的Cookie值
   - 粘贴到插件设置中
   ```

3. **检查网盘链接格式**
   ```
   正确格式：
   - https://pan.quark.cn/s/xxxxxxxxx
   - https://pan.quark.cn/s/xxxxxxxxx?pwd=abcd
   
   错误格式：
   - http://pan.quark.cn/... (缺少s)
   - 其他格式的链接
   ```

4. **等待重试**
   ```
   - 如果是服务器错误，等待5-10分钟后重试
   - 避免频繁点击转存按钮
   ```

#### 2. "转存失败: 夸克网盘Cookie未配置"

**解决方案：**
1. 进入"网盘链接" → "设置"
2. 在夸克网盘Cookie字段填入有效的Cookie
3. 点击"测试Cookie"验证有效性
4. 保存设置

#### 3. "转存失败: 未找到可转存的文件"

**可能原因：**
- 分享链接已过期
- 分享链接需要提取码但未提供
- 分享的文件已被删除

**解决方案：**
1. 检查原始链接是否可以正常访问
2. 确认提取码是否正确（如果需要）
3. 联系分享者确认文件状态

#### 4. "转存失败: 夸克网盘Cookie已失效，请重新配置"

**解决方案：**
1. 重新登录夸克网盘
2. 获取新的Cookie
3. 在插件设置中更新Cookie
4. 重新测试转存功能

### Excel导入错误

#### 1. "Excel文件读取失败"

**可能原因：**
- 文件格式不支持
- 文件损坏
- 文件过大

**解决方案：**
1. 确保文件是.xlsx格式（推荐）
2. 检查文件大小不超过10MB
3. 尝试重新保存Excel文件
4. 使用"文件预览"功能检查文件内容

#### 2. "不支持的网盘链接格式"

**解决方案：**
1. 检查Excel中的链接格式是否正确
2. 支持的格式：
   - 百度网盘：`https://pan.baidu.com/s/xxxxx`
   - 夸克网盘：`https://pan.quark.cn/s/xxxxx`
   - 迅雷网盘：`https://pan.xunlei.com/s/xxxxx`
   - 磁力链：`magnet:?xt=urn:btih:xxxxx`

### 定时清理问题

#### 1. "定时清理不工作"

**检查步骤：**
1. 确认WordPress定时任务正常运行
2. 检查服务器是否支持cron jobs
3. 查看日志中是否有清理记录

**解决方案：**
1. 手动触发清理测试功能
2. 联系主机商确认cron支持
3. 考虑使用外部cron服务

### 权限问题

#### 1. "权限不足"

**解决方案：**
1. 确认当前用户具有管理员权限
2. 检查WordPress用户角色设置
3. 确认插件已正确激活

### 网络问题

#### 1. "网络请求失败"

**可能原因：**
- 服务器网络限制
- 防火墙阻止
- SSL证书问题

**解决方案：**
1. 检查服务器网络连接
2. 确认可以访问外部网站
3. 联系主机商解除相关限制

## 调试技巧

### 1. 查看详细日志

1. 进入"网盘链接" → "日志"
2. 筛选查看相关错误记录
3. 查看详细错误信息和调试数据

### 2. 测试Cookie有效性

1. 进入"网盘链接" → "设置"
2. 点击对应网盘的"测试Cookie"按钮
3. 查看返回的用户信息和容量信息

### 3. 使用文件预览

1. 在导入Excel时使用"从插件目录选择"方式
2. 点击"预览"按钮查看文件数据质量
3. 检查数据分析结果

### 4. 启用调试模式

在wp-config.php中添加：
```php
define('WP_DEBUG', true);
define('WP_DEBUG_LOG', true);
```

然后查看WordPress错误日志。

## 获取支持

### 准备信息

在寻求支持时，请准备以下信息：

1. **错误信息**：完整的错误提示
2. **操作步骤**：导致错误的具体操作
3. **环境信息**：
   - WordPress版本
   - PHP版本
   - 插件版本
   - 服务器环境
4. **日志记录**：相关的错误日志

### 常见解决方案总结

| 错误类型 | 主要原因 | 解决方案 |
|---------|----------|----------|
| HTTP 500 | 服务器错误/Cookie失效 | 重新获取Cookie，等待重试 |
| HTTP 403 | 权限不足/Cookie无效 | 更新Cookie，检查权限 |
| HTTP 404 | 链接不存在 | 验证原始链接有效性 |
| 网络超时 | 网络问题/请求过频 | 检查网络，降低请求频率 |
| 文件读取失败 | 文件格式/损坏 | 检查文件格式和完整性 |

### 预防措施

1. **定期更新Cookie**：建议每周检查一次
2. **备份重要文件**：保留Excel文件副本
3. **监控日志**：定期查看操作日志
4. **测试验证**：重要操作前先小规模测试

### 联系支持

如果问题仍然无法解决，请通过以下方式获取支持：

- GitHub Issues
- 邮箱：support@example.com
- 提供详细的错误信息和操作步骤

---

**注意**：网盘API可能会发生变化，如遇到新的错误，请查看最新的文档更新。